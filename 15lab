#include <stdio.h>//ввод-вывод
#include <stdlib.h>//включает определения для функций управления памятью, включая выделение и освобождение памяти.
#include <string.h>//для работы со строками

struct Toy {
    char name[50];//название
    float price;//цена
    char store[50];//магазин
};

// Функция для добавления записи в файл
void addRecord(FILE *file) {//пререходит в файл и позволяет пользователю добавлять запись (игрушку) в файл.
    struct Toy toy;//для хренения данных об игрушке

    printf("Введите название игрушки: ");
    scanf("%s", toy.name);//считывает названия игрушки и сохраняет 
    printf("Введите цену игрушки: ");
    scanf("%f", &toy.price);//считывает цену игрушки и сохраняет 
    printf("Введите название магазина: ");
    scanf("%s", toy.store);//считывает названия магазина и сохраняет

    fwrite(&toy, sizeof(struct Toy), 1, file);//позволяет записать данные в виде последовательности байтов в файл
}//&toy - указатель на структуру, 1 - количество элементов (в данном случае 1 структура Toy)

int main() {
    FILE *file;//объявление переменных файла, игрушки, строки для поиска и переменной выбора.
    struct Toy toy;
    char searchName[50];//для хранения строки, которую пользователь вводит для поиска.
    int choice = 0;// для хранения выбора операции пользователем.

    while (1) {// цикл, который будет выполняться до тех пор, пока не будет выполнена операция выхода из программы.
        printf("\nВыберите операцию с файлом:\n");
        printf("1. Добавить товар\n");
        printf("2. Узнать о товаре\n");
        printf("3. Выйти из программы\n");
        scanf("%d", &choice);//считывание выбора операции от пользователя и сохранение в переменную 

        switch (choice) {//определяет какую опирацию выполнять
            case 1:
                file = fopen("PRICE.dat", "ab"); // append, binary
                if (file == NULL) {//проверка, было ли успешно открытие файла.
                    fprintf(stderr, "Ошибка открытия файла\n");
                    return 1;
                }

                addRecord(file);//запрашивает данные и сохраняет в файл
                fclose(file);
                break;

            case 2://поиск игрушки
                printf("Введите название игрушки для поиска: ");
                scanf("%s", searchName);

                file = fopen("PRICE.dat", "rb");
                if (file == NULL) {//проверка, было ли успешно открытие файла.
                    fprintf(stderr, "Ошибка открытия файла\n");//stderr-вывод сообщения об ошибке
                    return 1;
                }

                int found = 0;//переменная для отслеживания товара в файле
                while (fread(&toy, sizeof(struct Toy), 1, file)) {//читает данные структуры
                    if (strcmp(toy.name, searchName) == 0) {//проверка на совпадения названия игрушки
                        found = 1;//если нашелся товар с таким же названием
                        printf("Название: %s\n", toy.name);
                        printf("Цена: %.2f\n", toy.price);
                        printf("Магазин: %s\n", toy.store);
                        break;
                    }
                }

                if (!found) {//если не найдено
                    printf("Игрушки с таким названием нет в базе данных\n");
                }

                fclose(file);//закрытие файла
                break;

            case 3://выход из программы
                return 0;

            default:// если не совпадает не с одним из case
                printf("Некорректный выбор операции\n");
                break;
        }
    }

    return 0;
}
